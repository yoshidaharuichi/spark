<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haruichi - Code & Aperture</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                        serif: ['Noto Serif SC', 'serif'],
                    },
                    colors: {
                        dark: '#0a0a0a',
                        light: '#f4f4f4',
                        accent: '#FF3333'
                    },
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                color: theme('colors.gray.300'),
                                h1: { color: theme('colors.white') },
                                h2: { color: theme('colors.white') },
                                h3: { color: theme('colors.white') },
                                strong: { color: theme('colors.white') },
                                code: { color: theme('colors.pink.400') },
                                blockquote: { borderLeftColor: theme('colors.gray.700'), color: theme('colors.gray.400') },
                            },
                        },
                    }),
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Fira+Code:wght@400&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { cursor: default; }
        
        /* Markdown Content Styling */
        .markdown-body h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1.5rem; line-height: 1.1; letter-spacing: -0.02em; }
        .markdown-body h2 { font-size: 1.75rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1rem; letter-spacing: -0.01em; }
        .markdown-body p { margin-bottom: 1.5rem; line-height: 1.8; font-family: 'Noto Serif SC', serif; font-size: 1.1rem; color: #d1d5db; }
        .markdown-body pre { background: #1a1a1a; padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 2rem; border: 1px solid #333; }
        .markdown-body code { font-family: 'Fira Code', monospace; font-size: 0.9em; }
        .markdown-body blockquote { border-left: 4px solid #444; padding-left: 1rem; margin-left: 0; font-style: italic; color: #888; }
        .markdown-body img { width: 100%; border-radius: 4px; margin: 2rem 0; opacity: 0.9; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .markdown-body a { color: #fff; text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 4px; }
        .markdown-body a:hover { color: #f9a8d4; }

        /* Light mode overrides for markdown */
        body:not(.bg-dark) .markdown-body h1, 
        body:not(.bg-dark) .markdown-body h2, 
        body:not(.bg-dark) .markdown-body h3, 
        body:not(.bg-dark) .markdown-body strong { color: #000; }
        body:not(.bg-dark) .markdown-body p { color: #333; }
        body:not(.bg-dark) .markdown-body pre { background: #f0f0f0; border: 1px solid #ddd; }
        body:not(.bg-dark) .markdown-body a { color: #000; }

        .marquee-container { overflow: hidden; white-space: nowrap; }
        .marquee-content { display: inline-block; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }

        /* Transitions */
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Loading Spinner */
        .loader { border: 2px solid rgba(255,255,255,0.1); border-left-color: #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-dark text-light transition-colors duration-500 selection:bg-pink-300 selection:text-black font-sans antialiased min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full z-50 mix-blend-difference text-white px-6 py-6 flex justify-between items-center bg-transparent backdrop-blur-sm">
        <a href="#" onclick="router.navigate('home'); return false;" class="font-bold text-xl tracking-tighter cursor-pointer">HARU<span class="text-xs align-top opacity-50">.BLOG</span></a>
        
        <div class="hidden md:flex space-x-12 text-sm font-mono uppercase tracking-widest">
            <a href="#" onclick="router.navigate('about'); return false;" class="hover:line-through decoration-2 decoration-white">ÂÖ≥‰∫éÊàë</a>
            <a href="#" onclick="router.navigate('categories'); return false;" class="hover:line-through decoration-2 decoration-white">ÂàÜÁ±ª</a>
            <a href="#" onclick="router.navigate('all-posts'); return false;" class="hover:line-through decoration-2 decoration-white">ÊâÄÊúâÊñáÁ´†</a>
        </div>

        <button id="theme-toggle" class="text-xs font-mono border border-white/30 px-3 py-1 rounded-full hover:bg-white hover:text-black transition-all uppercase">
            Switch Vibe
        </button>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="fixed bottom-6 right-6 z-50 md:hidden">
        <button onclick="router.navigate('all-posts')" class="bg-white text-black px-6 py-3 rounded-full font-bold shadow-lg">ÈòÖËØª</button>
    </div>

    <!-- Main Content Container -->
    <main id="app-root" class="flex-grow pt-24 px-6 relative min-h-[60vh]">
        <!-- Content will be injected here by JS -->
        <div class="flex justify-center items-center h-full pt-20">
            <div class="loader mr-2"></div> <span class="font-mono text-sm opacity-50">INITIALIZING SYSTEM...</span>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-12 border-t border-white/10 mt-auto px-6">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between text-xs font-mono uppercase tracking-widest text-gray-500">
            <div>¬© 2025 Haruichi. Shanghai / Mountain View.</div>
            <div class="mt-4 md:mt-0">
                <a href="#" class="hover:text-white mr-4">RSS</a>
                <a href="#" class="hover:text-white">Email</a>
            </div>
        </div>
    </footer>

    <!-- Templates & Data -->
    <script>
        // --- 1. Êï∞ÊçÆÁÆ°ÁêÜ (Data Management) ---
        
        // ÈªòËÆ§ÁöÑÂõûÈÄÄÊï∞ÊçÆÔºàÂΩìÊó†Ê≥ïËØªÂèñ posts.json Êó∂ÊòæÁ§∫Ôºå‰øùËØÅÈ¢ÑËßàÊ≠£Â∏∏Ôºâ
        const FALLBACK_DATA = [
            {
                "id": "post-1",
                "title": "[Á§∫‰æã] Chrome Arts ÂÆûÈ™åÔºöÂΩì WebGL ÈÅá‰∏ä‰∏úÊñπÊ∞¥Â¢®",
                "date": "2024-03-15",
                "category": "Creative Coding",
                "desc": "ËøôÊòØ‰∏Ä‰∏™ÂÜÖÁΩÆÁöÑÁ§∫‰æãÊñáÁ´†„ÄÇÂ¶ÇÊûú‰Ω†ÁúãÂà∞‰∫ÜËøô‰∏™ÔºåËØ¥Êòé posts.json Âä†ËΩΩÂ§±Ë¥•ÊàñÂ§Ñ‰∫éÈ¢ÑËßàÊ®°Âºè„ÄÇ",
                "content": "# Chrome Arts ÂÆûÈ™å\n\nËøôÊòØ**ÂÜÖÁΩÆÊï∞ÊçÆ**„ÄÇËØ∑ÈÖçÁΩÆ posts.json ‰ª•Âä†ËΩΩÂ§ñÈÉ®ÂÜÖÂÆπ„ÄÇ\n\n## Ê†∏ÂøÉÁÆóÊ≥ï\n\n```glsl\nfloat inkSpread(vec2 uv, float time) {\n    return smoothstep(0.4, 0.6, noise * paperGrain);\n}\n```"
            },
            {
                "id": "post-2",
                "title": "[Á§∫‰æã] ÊûÑÂª∫ËôöÊãüÊöóÊàøÔºöÂ§çÂàªÊüØËææ Portra 400 Ëâ≤ÂΩ©",
                "date": "2024-02-28",
                "category": "Photography",
                "desc": "ÈÄöËøáÂàÜÊûêÊï∞ÂçÉÂº†ËÉ∂ÁâáÊâ´Êèè‰ª∂ÔºåÁî® LUT Âíå AI ËøòÂéüÁªèÂÖ∏ËÉ∂ÁâáÊÑü„ÄÇ",
                "content": "# Portra 400 Ëâ≤ÂΩ©ÂàÜÊûê\n\nËøô‰πüÊòØÂÜÖÁΩÆÁöÑ**Fallback Data**„ÄÇ"
            }
        ];

        let blogData = {
            posts: [],
            about: `
# ÂÖ≥‰∫é Haruichi

**Code & Aperture.**

ÊàëÊòØ HaruichiÔºåÁõÆÂâçÂú® Google Â∑•‰ΩúÁöÑ Creative Developer„ÄÇ

* üéì 985 Êú¨Á°ïÔºå‰∏ª‰øÆËÆ°ÁÆóÊú∫ÁßëÂ≠¶‰∏éÊï∞Â≠óÂ™í‰ΩìËâ∫ÊúØ„ÄÇ
* üíª ÊìÖÈïøÂâçÁ´ØÂõæÂΩ¢Â≠¶ (WebGL, Three.js) Âíå‰∫§‰∫íËÆæËÆ°„ÄÇ
* üì∑ ÂæïÂç°Áî®Êà∑ÔºåËÉ∂ÁâáÊëÑÂΩ±Â∏àÔºåËá¥Âäõ‰∫éÁî®ÊäÄÊúØËøòÂéüÊ®°ÊãüÂΩ±ÂÉèÁöÑË¥®ÊÑü„ÄÇ

*Ê≥®ÊÑèÔºöË¶Å‰øÆÊîπÊ≠§È°µÈù¢ÔºåËØ∑ÂàõÂª∫ blog/posts/about.md Âπ∂Êõ¥Êñ∞ posts.json ÈìæÊé•„ÄÇ*
            `
        };

        // Ê†∏ÂøÉÂä†ËΩΩÈÄªËæë
        async function loadSystem() {
            try {
                // 1. Â∞ùËØïÂä†ËΩΩÊ∏ÖÂçïÊñá‰ª∂
                console.log("Ê≠£Âú®Â∞ùËØïÂä†ËΩΩ posts.json...");
                const response = await fetch('posts.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const manifest = await response.json();
                console.log("ÊàêÂäüÂä†ËΩΩÂ§ñÈÉ®ÈÖçÁΩÆ:", manifest);
                
                // Â∞ÜÂä†ËΩΩÁöÑÊï∞ÊçÆÊò†Â∞ÑÂà∞ blogData
                blogData.posts = manifest;
                
                // Ê£ÄÊü•ÊòØÂê¶Êúâ about ÁöÑÈÖçÁΩÆÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰øùÊåÅÈªòËÆ§
                // ÂèØ‰ª•Âú® json ‰∏≠Ê∑ªÂä† special pages ÈÖçÁΩÆ
                
            } catch (e) {
                console.warn("Âä†ËΩΩ posts.json Â§±Ë¥• (È¢ÑËßàÁéØÂ¢ÉÊ≠£Â∏∏Áé∞Ë±°), ‰ΩøÁî®ÂÜÖÁΩÆÂõûÈÄÄÊï∞ÊçÆ„ÄÇ", e);
                blogData.posts = FALLBACK_DATA;
                
                // ‰ªÖÂú®È¢ÑËßàÊ®°Âºè‰∏ãÊòæÁ§∫ÊèêÁ§∫
                showToast("Preview Mode: Using fallback data");
            }

            // ÂàùÂßãÂåñË∑ØÁî±
            router.init();
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 left-4 bg-white text-black px-4 py-2 text-xs font-mono z-50 fade-in';
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // --- 2. Ë∑ØÁî±‰∏éËßÜÂõæÊéßÂà∂ (Router & View Controller) ---
        const appRoot = document.getElementById('app-root');

        const router = {
            routes: {
                'home': renderHome,
                'about': renderAbout,
                'categories': renderCategories,
                'all-posts': renderAllPosts,
                'post': renderPostDetail
            },
            navigate(route, params = null) {
                window.location.hash = route + (params ? '/' + params : '');
                // Logic moved to hashchange listener to support back/forward buttons
            },
            init() {
                const handleHash = () => {
                    let hash = window.location.hash.slice(1);
                    if (!hash) hash = 'home';
                    
                    const [route, ...params] = hash.split('/');
                    const renderer = this.routes[route] || this.routes['home'];
                    
                    // ËøáÊ∏°Âä®Áîª
                    appRoot.style.opacity = '0';
                    appRoot.style.transform = 'translateY(5px)';
                    
                    setTimeout(async () => {
                        await renderer(params.join('/'));
                        appRoot.classList.remove('fade-in');
                        void appRoot.offsetWidth; 
                        appRoot.classList.add('fade-in');
                        appRoot.style.opacity = '1';
                        appRoot.style.transform = 'translateY(0)';
                        window.scrollTo(0, 0);
                    }, 200);
                };
                
                window.addEventListener('hashchange', handleHash);
                handleHash(); // Initial load
            }
        };

        // --- 3. ËßÜÂõæÊ∏≤ÊüìÂáΩÊï∞ (Renderers) ---

        async function renderHome() {
            const recentPosts = blogData.posts.slice(0, 3); // Take top 3
            
            let postsHtml = recentPosts.map(post => `
                <div onclick="router.navigate('post', '${post.id}')" class="group relative border-b border-white/10 py-8 hover:bg-white hover:text-black transition-colors duration-300 cursor-pointer project-item">
                    <div class="flex flex-col md:flex-row md:items-center justify-between px-4">
                        <div class="font-mono text-xs opacity-50 mb-2 md:mb-0 group-hover:text-black">#${(post.category || 'BLOG').toUpperCase().slice(0,4)}-${(post.date || '2025').slice(0,4)}</div>
                        <div class="flex-1 md:mx-8">
                            <div class="text-2xl md:text-4xl font-bold tracking-tight">${post.title}</div>
                            <div class="text-sm font-mono mt-2 opacity-60 group-hover:text-black max-w-xl">${post.desc || 'No description'}</div>
                        </div>
                        <div class="font-mono text-xs mt-4 md:mt-0 opacity-50 group-hover:text-black whitespace-nowrap">${post.date}</div>
                    </div>
                </div>
            `).join('');

            appRoot.innerHTML = `
                <!-- Hero Section -->
                <section class="py-12 md:py-20 relative overflow-hidden mb-12">
                    <div class="absolute -right-20 top-0 text-[15vw] font-black opacity-[0.03] leading-none pointer-events-none select-none">
                        BLOG
                    </div>
                    <div class="max-w-5xl mx-auto w-full z-10">
                        <p class="font-mono text-sm text-gray-400 mb-4">‚Ä¢ Haruichi's Digital Garden</p>
                        <h1 class="text-5xl md:text-7xl font-extrabold tracking-tighter uppercase mb-6">
                            Thinking in<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-gray-200 to-gray-500">Pixels & Grain</span>
                        </h1>
                    </div>
                </section>

                <!-- Marquee -->
                <div class="py-8 mb-16 border-y border-white/10 bg-white/5 marquee-container font-mono text-xs tracking-widest uppercase">
                    <div class="marquee-content">
                        LATEST UPDATES ‚Ä¢ TECH INSIGHTS ‚Ä¢ PHOTOGRAPHY JOURNAL ‚Ä¢ WEBGL EXPERIMENTS ‚Ä¢ LATEST UPDATES ‚Ä¢ TECH INSIGHTS ‚Ä¢ PHOTOGRAPHY JOURNAL ‚Ä¢
                    </div>
                </div>

                <!-- Recent Posts List -->
                <section class="max-w-5xl mx-auto">
                    <div class="mb-12 flex items-end justify-between border-b border-white/10 pb-4">
                        <h3 class="text-xl font-mono uppercase tracking-widest text-gray-400">ÊúÄÊñ∞ÂèëÂ∏É / Recent</h3>
                        <a href="#" onclick="router.navigate('all-posts'); return false;" class="text-sm hover:underline">View All -></a>
                    </div>
                    <div class="space-y-2">
                        ${postsHtml}
                    </div>
                </section>
            `;
        }

        async function renderAllPosts() {
            let postsHtml = blogData.posts.map(post => `
                <div onclick="router.navigate('post', '${post.id}')" class="group relative border-b border-white/10 py-6 hover:bg-white hover:text-black transition-colors duration-300 cursor-pointer">
                    <div class="flex flex-col md:flex-row md:items-baseline justify-between px-4">
                        <div class="text-xl md:text-2xl font-bold tracking-tight mb-2 md:mb-0">${post.title}</div>
                        <div class="font-mono text-xs opacity-50 group-hover:text-black">${post.date}</div>
                    </div>
                </div>
            `).join('');

            appRoot.innerHTML = `
                <section class="max-w-4xl mx-auto py-12">
                    <h1 class="text-4xl md:text-6xl font-black tracking-tighter mb-12">ALL ARTICLES</h1>
                    <div class="space-y-2">
                        ${postsHtml}
                    </div>
                </section>
            `;
        }

        async function renderCategories() {
            const categories = {};
            blogData.posts.forEach(post => {
                const cat = post.category || 'Uncategorized';
                categories[cat] = (categories[cat] || 0) + 1;
            });

            const catHtml = Object.keys(categories).map(cat => `
                <div class="border border-white/20 p-8 hover:border-white transition-colors cursor-pointer group" onclick="alert('Filtering logic would go here!')">
                    <div class="text-xs font-mono opacity-50 mb-4">CATEGORY</div>
                    <div class="text-3xl font-bold mb-2 group-hover:text-pink-300 transition-colors">${cat}</div>
                    <div class="font-mono text-xs text-gray-400">${categories[cat]} Posts</div>
                </div>
            `).join('');

            appRoot.innerHTML = `
                <section class="max-w-5xl mx-auto py-12">
                    <h1 class="text-4xl md:text-6xl font-black tracking-tighter mb-12">CATEGORIES</h1>
                    <div class="grid md:grid-cols-2 gap-6">
                        ${catHtml}
                    </div>
                </section>
            `;
        }

        async function renderPostDetail(id) {
            const post = blogData.posts.find(p => p.id === id);
            if (!post) {
                appRoot.innerHTML = `<div class="text-center py-20">Article not found. <br><a onclick="router.navigate('home')" class="underline cursor-pointer">Go Home</a></div>`;
                return;
            }

            // --- Âä®ÊÄÅÂä†ËΩΩ Markdown ÈÄªËæë ---
            let markdownText = "";
            
            // Â¶ÇÊûú post ÂØπË±°ÈáåÊúâ 'file' Â±ûÊÄßÔºåËØ¥ÊòéÊòØÂ§ñÈÉ®Êñá‰ª∂
            if (post.file) {
                appRoot.innerHTML = `<div class="text-center py-20"><div class="loader"></div><br><span class="font-mono text-xs mt-4 block">LOADING ${post.file}...</span></div>`;
                try {
                    const res = await fetch(post.file);
                    if (!res.ok) throw new Error("File fetch failed");
                    markdownText = await res.text();
                } catch (e) {
                    console.error(e);
                    markdownText = `# Error\n\nCould not load file: \`${post.file}\`.\n\nPlease check if the file exists in the \`posts/\` folder.`;
                }
            } else {
                // Â¶ÇÊûúÊ≤°Êúâ file Â±ûÊÄßÔºåÂ∞ùËØï‰ΩøÁî® content Â±ûÊÄßÔºàÁî®‰∫éÈ¢ÑËßàÊ®°ÂºèÁöÑÂõûÈÄÄÊï∞ÊçÆÔºâ
                markdownText = post.content || "# No Content";
            }

            const htmlContent = marked.parse(markdownText);

            appRoot.innerHTML = `
                <article class="max-w-3xl mx-auto py-12">
                    <button onclick="window.history.back()" class="font-mono text-xs mb-8 hover:text-white text-gray-500 hover:underline">‚Üê BACK</button>
                    
                    <header class="mb-12 border-b border-white/10 pb-8">
                        <div class="font-mono text-xs text-pink-400 mb-4"># ${(post.category || 'GENERAL').toUpperCase()}</div>
                        <h1 class="text-4xl md:text-6xl font-black tracking-tighter leading-tight mb-6">${post.title}</h1>
                        <div class="flex justify-between items-center font-mono text-xs text-gray-500">
                            <span>PUBLISHED: ${post.date}</span>
                            <span>AUTHOR: HARUICHI</span>
                        </div>
                    </header>

                    <div class="markdown-body text-gray-300">
                        ${htmlContent}
                    </div>

                    <div class="mt-20 pt-12 border-t border-white/10 text-center">
                        <h3 class="font-mono text-sm mb-4">THANKS FOR READING</h3>
                        <button onclick="router.navigate('all-posts')" class="border border-white/30 px-6 py-3 rounded-full hover:bg-white hover:text-black transition-all text-sm font-bold">
                            Read More Articles
                        </button>
                    </div>
                </article>
            `;
        }

        async function renderAbout() {
            // Âú®ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÔºåËøôÈáå‰πüÂèØ‰ª• fetch('posts/about.md')
            const htmlContent = marked.parse(blogData.about);
            appRoot.innerHTML = `
                <div class="max-w-3xl mx-auto py-12">
                     <div class="markdown-body">
                        ${htmlContent}
                    </div>
                </div>
            `;
        }

        // --- 4. ÂàùÂßãÂåñ ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const body = document.body;
        const nav = document.querySelector('nav');
        let isDark = true;

        themeToggleBtn.addEventListener('click', () => {
            isDark = !isDark;
            if (isDark) {
                body.classList.remove('bg-gray-100', 'text-black');
                body.classList.add('bg-dark', 'text-light');
                nav.classList.add('mix-blend-difference', 'text-white');
                nav.classList.remove('text-black');
            } else {
                body.classList.remove('bg-dark', 'text-light');
                body.classList.add('bg-gray-100', 'text-black');
                nav.classList.remove('mix-blend-difference', 'text-white');
                nav.classList.add('text-black');
            }
        });

        // ÂêØÂä®Á≥ªÁªü
        loadSystem();

    </script>
</body>
</html>